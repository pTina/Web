<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- 위 3개의 메타 태그는 *반드시* head 태그의 처음에 와야합니다; 어떤 다른 콘텐츠들은 반드시 이 태그들 *다음에* 와야 합니다 -->
    <meta name="description" content="교통약자를 위한 장애인콜택시를 한 곳에서 검색할 수 있습니다.">
    <meta name="title" content="장애인콜택시 통합 조회">
    <meta name="keywords" content="장애인콜택시, 이동지원센터, 장애인콜택시 조회, 교통약자 이동지원센터">
    <title>장애인콜택시 통합 조회</title>

    <!-- jQuery -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>

    <!-- 부트스트랩 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <link href="css/index.css" rel="stylesheet">

    <!-- IE8 에서 HTML5 요소와 미디어 쿼리를 위한 HTML5 shim 와 Respond.js -->
    <!-- WARNING: Respond.js 는 당신이 file:// 을 통해 페이지를 볼 때는 동작하지 않습니다. -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>
    <div class="site-wrapper">

        <div class="site-wrapper-inner">

            <div class="cover-container">

                <div class="masthead clearfix">
                    <header><h1 class="masthead-brand">장애인콜택시 통합 조회</h1></header>

                    <div id="boxSearch" class="row mb-4">
                        <div class="col">
                            <select class="area1 form-control">
                                <option value="none">==시·도==</option>
                            </select>
                        </div>
                        <div class="col">
                            <button class="btnSearch btn btn-default btn-block" type="submit" disabled>찾기</button>
                        </div>
                    </div>
                    <div class="row mb-4 typeCar">
                        <div class="col">차량종류 선택 </div>
                        <div class="col form-check">
                            <input class="form-check-input pointer" type="radio" name="flexRadioDefault" id="allVhcleCo"
                                checked disabled>
                            <label class="form-check-label pointer" for="allVhcleCo">
                                모두
                            </label>
                        </div>
                        <div class="col form-check">
                            <input class="form-check-input pointer" type="radio" name="flexRadioDefault"
                                id="slopeVhcleCo" disabled>
                            <label class="form-check-label pointer" for="slopeVhcleCo">
                                슬로프형
                            </label>
                        </div>
                        <div class="col form-check">
                            <input class="form-check-input pointer" type="radio" name="flexRadioDefault"
                                id="liftVhcleCo" disabled>
                            <label class="form-check-label pointer" for="liftVhcleCo">
                                리프트형
                            </label>
                        </div>
                    </div>
                    <p>검색 결과의 센터명을 클릭하여 상세정보를 확인하세요.</p>

                    <div id="boxResult">
                        <div id="listTitle" class="row">
                            <div class="col">센터명</div>
                            <div class="col">이용시간</div>
                            <div class="col">전화번호</div>
                            <div class="col">사이트</div>
                        </div>

                        <main id="boxListItem"></main>
                    </div>


                    <footer class="mastfoot">
                        <div class="inner">
                            <p>2022 yemni_pTina</p>
                        </div>
                    </footer>

                </div>
            </div>

        </div>

        <div class="modal fade show" id="modalDetail" tabindex="-1" aria-labelledby="modaLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
            </div>
        </div>

        <div class="modal fade bs-example-modal-lg" id="daumPostCode" tabindex="-1" role="dialog"
            aria-labelledby="modalPostCode" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="modalPostCode">우편번호검색</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="container-fluid" id="postCodeWrap"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- jQuery (부트스트랩의 자바스크립트 플러그인을 위해 필요합니다) -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>


        <!-- 모든 컴파일된 플러그인을 포함합니다 (아래), 원하지 않는다면 필요한 각각의 파일을 포함하세요 -->
        <!-- <script src="js/bootstrap/bootstrap.min.js"></script> -->
        <!-- <script src="js/koreaArea.json"></script> -->
        <!-- <script src="js/searchInfo.js"></script> -->

        <script type="module" src="js/index.js"></script>
        <!-- <script type="module" src="js/dataSearch.js"></script> -->
        <script src="js/observer.js"></script>
        <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
        <script src="js/kakaoNavi.js"></script>
        <script src="js/route.js"></script>

        <script type="text/javascript">
            let popModal = null;



            // $(document).on('click', '.name', (e) => {
            //     const $target = $(e.target);
            //     const $popModal = $($target.attr('data-target'));
            //     popModal = $popModal;
            // })

            // $(document).on('click', '#modalDetail', (e) => {
            //     popModal = null;
            // })

            // $('#modalDetail').on('hide.bs.modal', (e)=>{
            //   const $target = $(e.target);
            //   console.log($target);
            // })

            const route = new Route();

            observer.register("setSummary", route.setSummary, route);
            observer.register("setRoute", route.setRoute, route);

            $(document).on('click', '#btnPrice', (e) => {
                if (route.isEmpty()) {
                    alert('출발지와 도착지를 모두 지정해주세요.');
                    return false;
                }

                const option = {
                    origin: `${route.origin.x}, ${route.origin.y}`,
                    destination: `${route.destination.x}, ${route.destination.y}`
                };

                const naviData = new NaviData(option);
            })

            $(document).on('click', '.btnMap', (e) => {
                const self = this;
                const $this = $(e.target);
                const data = $this.attr('data');
                const $target = $(`#${data}`);
                this.type = data;



                // new daum.Postcode({
                //   oncomplete: function (data) {
                //     const _address = data.address;
                //     const _addressType = getAddressType(data.userSelectedType);
                //     $target.html(_address);

                //     const infoObj = {
                //       address: _address,
                //       type: _addressType
                //     };
                //     Geocoder(getOption(infoObj), self.type);
                //   }
                // }).open(
                //   {
                //     popupKey: 'popup1'
                // });

                const element_wrap = document.getElementById('postCodeWrap');
                // 현재 scroll 위치를 저장해놓는다.
                // var currentScroll = Math.max(document.body.scrollTop, document.documentElement.scrollTop);
                // const currentScroll = (0, 0);
                new daum.Postcode({
                    oncomplete: function (data) {
                        const _address = data.address;
                        const _addressType = getAddressType(data.userSelectedType);
                        $target.html(_address);

                        const infoObj = {
                            address: _address,
                            type: _addressType
                        };
                        Geocoder(getOption(infoObj), self.type);

                        $('#daumPostCode .close').trigger('click');

                        // element_wrap.hide();

                        // 우편번호 찾기 화면이 보이기 이전으로 scroll 위치를 되돌린다.
                        // document.body.scrollTop = currentScroll;

                    },
                    // 우편번호 찾기 화면 크기가 조정되었을때 실행할 코드를 작성하는 부분. iframe을 넣은 element의 높이값을 조정한다.
                    // onresize: function (size) {
                    //   element_wrap.css('height', size.height + 'px');
                    // },
                    // width: '100%',
                    // height: '100%'
                }).embed(element_wrap);


                // iframe을 넣은 element를 보이게 한다.
                // element_wrap.style.display = 'block';


            })

            function getAddressType(type) {
                // type(input): R(도로명), J(지번)
                // return(output): ROAD (도로명주소), PARCEL(지번주소)
                switch (type) {
                    case 'R':
                        return 'ROAD';
                    case 'J':
                        return 'PARCEL';
                    default:
                        return 'address type is null';
                }
            }

            function Geocoder(opt, type) {
                const _type = type;
                const KEY = 'D0D2757E-08D6-3BF1-A6C6-41B4D0E929B3';
                const _url = `http://api.vworld.kr/req/address?service=address&request=getCoord&format=json&{{option}}&key=${KEY}`;
                const URL = _url.replace('{{option}}', encodeURI(opt));

                const req = new Request(URL);
                const position = '';

                fetch(req)
                    .then(response => response.json())
                    .then(data => {
                        const _x = data.response.result.point.x;
                        const _y = data.response.result.point.y;

                        observer.notify("setRoute", { type: _type, x: _x, y: _y });
                    })
                    .catch(err => console.log(err));
            }

            function getOption(object) {
                let option = '';
                Object.entries(object).forEach(([key, value]) => {
                    option += `${key}=${value}&`;
                });

                return option.slice(0, -1);
            }

        </script>
</body>

</html>